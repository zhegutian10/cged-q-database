# 清代官员信息可视化系统

基于中国历史官员量化数据库（CGED-Q）的交互式可视化网页应用

## 📊 数据说明

本系统现已支持读取Stata格式的CGED-Q数据文件：
- **数据文件**: `data/CGED-Q Public Release 1760-1798  1 Jul 2024.dta`
- **数据时段**: 1760-1798年（乾隆至嘉庆年间）
- **记录数量**: 约20万条官员任职记录

## 功能特性

### 1. 官员个人信息展示
- **基本信息卡片**：展示官员的姓名、字号、籍贯、出身、科年、官职、机构、地区、旗分、身份、爵位等完整信息
- **信息网格布局**：采用响应式网格设计，信息清晰易读

### 2. 仕途时间线可视化
- **时间轴展示**：按自然年变化展示官员的仕途发展历程
- **职位变迁**：清晰显示每个时间点的官职、地区和机构信息
- **交互式图表**：支持鼠标悬停查看详细信息

### 3. 地理轨迹图 ⭐ 新功能
- **清代地图可视化**：在中国地图上显示任职地点，支持50+清代主要地名
- **时间轴功能**：按年份查看地理轨迹变化，支持自动播放
- **智能地名映射**：自动匹配清代地名（如顺天、江宁等）到现代坐标
- **轨迹动画**：显示官员任职地点的时间演变过程
- **交互式地图**：支持缩放、拖拽，查看详细信息
- **备用饼图**：当地名无法识别时，自动显示统计饼图

### 4. 品级变化趋势 ⭐ 改进
- **清代九品十八级系统**：准确映射官职到品级（正一品至从九品）
- **品级识别**：支持100+常见清代官职的自动品级识别
- **趋势线图**：清晰展示品级升降，Y轴反转（品级越高数字越小）
- **品级标注**：显示正一品、正三品、正五品、正七品参考线
- **渐变填充**：视觉化品级变化趋势，更直观
- **详细提示**：鼠标悬停显示年份、官职和品级信息

### 5. 社交网络关系图 ⭐ 优化
- **同机构关系**：相同机构任职的官员（蓝色节点）
- **同乡关系**：相同籍贯省县的官员（绿色节点）
- **同期关系**：同年同季在职的官员（黄色节点）
- **师生关系**：同出身同科年的官员（红色节点）
- **家族关系**：同姓同籍贯的官员（青色节点）
- **力导向图**：采用力导向布局算法，自动优化节点位置
- **智能限制**：每种关系最多显示10个节点，总数不超过50个
- **交互式探索**：支持拖拽、缩放，点击节点高亮相关关系
- **彩色编码**：不同关系类型使用不同颜色区分

## 技术栈

- **前端框架**：原生HTML5 + CSS3 + JavaScript
- **图表库**：ECharts 5.4.3（Apache开源可视化库）
- **数据处理**：PapaParse 5.4.1（CSV/TSV文件解析）
- **编码支持**：多编码自动检测（UTF-8, GBK, GB2312, GB18030）
- **样式设计**：响应式设计，支持多种屏幕尺寸

## 使用方法

### 1. 数据准备

#### 方法一：自动转换（推荐）

使用提供的Python脚本自动将.dta文件转换为网页可用的.tab格式：

```bash
# 安装依赖
pip install pandas

# 运行转换脚本
python convert_dta_to_tab.py
```

脚本会自动查找 `data/CGED-Q Public Release 1760-1798  1 Jul 2024.dta` 并转换为 `.tab` 格式。

#### 方法二：使用Stata手动转换

如果您有Stata软件，可以手动转换：

```stata
use "data/CGED-Q Public Release 1760-1798  1 Jul 2024.dta", clear
export delimited using "data/CGED-Q Public Release 1760-1798  1 Jul 2024.tab", delimiter(tab) replace
```

### 2. 环境准备

确保您的项目目录结构如下：
```
项目根目录/
├── index.html                    # 主页面文件
├── convert_dta_to_tab.py        # 数据转换脚本
├── start_server.bat             # Windows启动脚本
├── start_server.sh              # Linux/Mac启动脚本
├── data/
│   ├── CGED-Q Public Release 1760-1798  1 Jul 2024.dta  # 原始数据
│   └── CGED-Q Public Release 1760-1798  1 Jul 2024.tab  # 转换后的数据
└── README.md                    # 说明文档
```

### 3. 启动应用

#### 方法一：使用本地服务器（推荐）
```bash
# 使用Python 3
python -m http.server 8000

# 或使用Python 2
python -m SimpleHTTPServer 8000

# 或使用Node.js的http-server
npx http-server
```

然后在浏览器中访问：`http://localhost:8000`

#### 方法二：直接打开文件
在浏览器中直接打开 `index.html` 文件（某些浏览器可能因CORS策略限制无法加载Excel文件）

### 4. 操作指南

#### 搜索官员
1. 在搜索框中输入官员姓名（支持姓或名的部分匹配）
2. 点击"搜索"按钮
3. 如果找到多个结果，会显示官员列表供选择
4. 如果只有一个结果，直接显示该官员的详细信息

#### 浏览所有官员
1. 点击"显示所有官员"按钮
2. 系统会列出数据库中的所有官员（已去重）
3. 点击任意官员查看详细信息

#### 查看可视化图表
1. 选择官员后，系统自动生成四种可视化图表
2. 点击标签页切换不同的可视化视图：
   - **仕途时间线**：查看官员的职业发展历程
   - **地理轨迹**：了解官员的任职地区分布
   - **品级变化**：分析官员的职位变迁
   - **社交网络**：探索官员的社会关系网络

#### 交互操作
- **图表缩放**：使用鼠标滚轮缩放图表
- **图表拖拽**：在网络图中可以拖拽节点
- **查看详情**：鼠标悬停在图表元素上查看详细信息
- **高亮关系**：在网络图中点击节点高亮相关连接

### 数据字段说明
主要字段包括：
- **基本信息**：姓、名、字号
- **籍贯信息**：籍贯省、籍贯县、原籍省、原籍县
- **身份信息**：身份一、身份二、旗分、爵位
- **出身信息**：出身一、出身二、科年一、科年二
- **职位信息**：官职一、官职二、机构一、机构二、机构三
- **地理信息**：地区、地名题头
- **时间信息**：阳历年份、版本年代、版本季节
- **其他信息**：缺分、官缺等级、加级、铨选信息等

## 技术说明

### 数据格式转换

由于浏览器无法直接读取Stata的.dta文件，系统采用以下方案：

1. **转换工具**: 使用Python的pandas库读取.dta文件
2. **中间格式**: 转换为制表符分隔的.tab文本文件
3. **前端解析**: 使用PapaParse库在浏览器中解析.tab文件

### 为什么使用.tab格式？

- ✅ 文本格式，浏览器可直接读取
- ✅ 保留所有字段和数据
- ✅ 文件大小适中
- ✅ 兼容性好

## 功能特点

### 1. 智能搜索
- 支持模糊匹配
- 自动去重显示
- 多结果智能处理

### 2. 数据可视化
- 多维度分析
- 交互式图表
- 响应式设计

### 3. 关系网络
- 多种关系类型
- 自动关系发现
- 可视化网络图

### 4. 用户体验
- 现代化界面设计
- 流畅的动画效果
- 直观的操作方式

## 浏览器兼容性

- Chrome 90+（推荐）
- Firefox 88+
- Safari 14+
- Edge 90+

## 特色功能详解

### 清代地名坐标映射
系统内置50+清代主要地名的坐标映射，包括：
- **直隶地区**：北京、顺天、天津、保定等
- **江南地区**：江苏、南京、江宁、苏州、浙江、杭州等
- **西北地区**：陕西、西安、甘肃、兰州、新疆等
- **东北地区**：奉天、盛京、吉林、黑龙江等
- **其他各省**：河南、山东、山西、四川、云南、贵州、广东、广西、福建等

### 品级识别系统
支持100+清代官职的品级自动识别：
- **正一品**：太师、太傅、太保、大学士、领侍卫内大臣等
- **从一品**：少师、少傅、少保、各部院尚书、都御史等
- **正二品**：各部院侍郎、内阁学士、翰林院掌院学士、总督等
- **从二品**：内阁学士、翰林院侍读学士、巡抚等
- **正三品至从九品**：各级官职的详细映射

### 社交网络分析
智能识别五种社交关系：
- **同机构**：在相同部门或衙门任职
- **同乡**：来自相同省份和县
- **同期**：同年同季在职
- **师生**：同出身同科年（可能是同年或师生）
- **家族**：同姓同籍贯（可能的家族关系）

## 注意事项

1. **数据文件路径**：确保 `data/CGED-Q Public Release 1760-1798  1 Jul 2024.tab` 文件存在
2. **浏览器安全策略**：必须使用本地服务器运行，避免CORS问题
3. **性能优化**：
   - 官员列表最多显示500条
   - 社交网络图限制最多50个节点
   - 地图时间轴按年份分组
4. **数据完整性**：某些官员可能缺少部分信息字段
5. **编码问题**：系统自动检测中文编码，支持UTF-8、GBK、GB2312、GB18030

## 扩展功能建议

### 可以添加的功能：
1. **数据导出**：支持将可视化结果导出为图片或PDF
2. **高级筛选**：按地区、出身、年代等条件筛选官员
3. **对比分析**：支持多个官员的对比分析
4. **统计报表**：生成各类统计报表
5. **时间轴动画**：动态展示历史变迁过程
6. **3D可视化**：使用3D图表展示复杂关系

### 数据扩展：
1. 加载更多时段的数据（1760-1798、1900-1912等）
2. 整合其他历史数据库（科举名录、同年齿录等）
3. 添加地理坐标数据，实现真实地图展示

## 开发者信息

- **项目类型**：历史数据可视化应用
- **开发框架**：原生Web技术
- **数据格式**：Excel (XLSX)
- **可视化引擎**：Apache ECharts

## 许可证

本项目基于CGED-Q公开数据开发，仅供学术研究和教育使用。

## 参考文献

任玉雪, 陈必佳, 陈俊, 郝小雯, 康文林, 李中清. 2025. 中国历史官员量化数据库―清代缙绅录时段公开版用户指南.

Campbell, Cameron Dougall; Chen, Bijia; Ren, Yuxue; Lee, James, 2019, "China Government Employee Database-Qing (CGED-Q) Jinshenlu Public Release", https://doi.org/10.14711/dataset/E9GKRS, DataSpace@HKUST, V1

## 联系方式

如有问题或建议，欢迎反馈。

## 更新日志

### v2.0 (2025-10-21)
- ✨ 新增清代地图可视化，支持时间轴和轨迹动画
- ✨ 实现清代九品十八级品级系统，支持100+官职识别
- ✨ 优化社交网络图，支持五种关系类型的彩色编码
- ✨ 添加50+清代地名坐标映射
- 🐛 修复中文编码显示问题，支持多编码自动检测
- 🐛 修复品级变化图显示异常
- 🐛 修复社交网络图布局问题
- 📝 完善文档说明和使用指南

### v1.0 (初始版本)
- 基础功能实现
- 官员信息展示
- 简单可视化图表

---

**最后更新时间**：2025年10月21日