
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸…ä»£å®˜å‘˜ä¿¡æ¯å¯è§†åŒ–ç³»ç»Ÿ - CGED-Q</title>
    <script src="lib/echarts.min.js"></script> 
    <script src="lib/papaparse.min.js"></script>
    <script>
        // æ³¨å†Œä¸­å›½åœ°å›¾æ•°æ® - ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ï¼ˆæœ€å¯é ï¼‰
        let chinaMapLoaded = false;
        
        async function loadChinaMap() {
            try {
                console.log('æ­£åœ¨åŠ è½½æœ¬åœ°åœ°å›¾æ•°æ®...');
                const response = await fetch('china.json');
                
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${response.status}`);
                }
                
                const data = await response.json();
                echarts.registerMap('china', data);
                chinaMapLoaded = true;
                console.log('âœ… åœ°å›¾æ•°æ®åŠ è½½æˆåŠŸï¼ˆæœ¬åœ°æ–‡ä»¶ï¼‰');
                return true;
            } catch (err) {
                console.error('âŒ åœ°å›¾æ•°æ®åŠ è½½å¤±è´¥:', err);
                console.error('è¯·ç¡®ä¿ china.json æ–‡ä»¶å·²ä¸Šä¼ åˆ°GitHubä»“åº“æ ¹ç›®å½•');
                return false;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åŠ è½½åœ°å›¾
        loadChinaMap();
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Serif SC', 'STSong', 'SimSun', serif;
            background: #1a1a1a;
            min-height: 100vh;
            color: #333;
        }

        /* é¦–é¡µæ ·å¼ */
        .hero-section {
            position: relative;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* ç§»è½´æ•ˆæœèƒŒæ™¯å±‚ - ä»å·¦ä¸Šåˆ°å³ä¸‹çš„é€è§†æ»šåŠ¨ */
        .parallax-bg {
            position: absolute;
            top: -10%;
            left: -10%;
            width: 120%;
            height: 120%;
            background: url('back.jpg') no-repeat;
            background-size: cover;
            animation: parallaxScroll 60s ease-in-out infinite;
            z-index: 0;
            will-change: transform;
        }

        @keyframes parallaxScroll {
            0% {
                transform: translate(0, 0) scale(1.1);
            }
            50% {
                transform: translate(-8%, -8%) scale(1.15);
            }
            100% {
                transform: translate(0, 0) scale(1.1);
            }
        }

        /* é®ç½©å±‚ */
        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.4);
            z-index: 1;
        }

        /* å†…å®¹å±‚ */
        .hero-content {
            position: relative;
            z-index: 2;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .logo {
            position: absolute;
            top: 30px;
            left: 40px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 10;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: #c8102e;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            font-weight: bold;
        }

        .logo-text {
            color: white;
            font-size: 18px;
            letter-spacing: 2px;
        }

        .hero-title {
            font-size: 4em;
            color: white;
            text-align: center;
            margin-bottom: 20px;
            margin-top: -80px;
            font-weight: 300;
            letter-spacing: 8px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.5);
        }

        .hero-subtitle {
            font-size: 1.2em;
            color: rgba(255,255,255,0.9);
            text-align: center;
            margin-bottom: 60px;
            letter-spacing: 3px;
        }

        .search-container {
            display: flex;
            gap: 0;
            max-width: 700px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            margin-bottom: 100px;
        }

        .search-input {
            flex: 1;
            padding: 20px 30px;
            border: none;
            font-size: 16px;
            background: white;
            border-radius: 0;
            outline: none;
        }

        .search-button {
            padding: 20px 50px;
            background: #c8102e;
            color: white;
            border: none;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .search-button:hover {
            background: #a00d24;
        }

        .stats-bar {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 100px;
            color: white;
            z-index: 10;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #c8102e;
        }

        .stat-label {
            font-size: 0.9em;
            margin-top: 5px;
            opacity: 0.8;
            letter-spacing: 2px;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content-wrapper {
            background: #f5f5f5;
            min-height: 100vh;
            padding: 0;
        }

        /* å†…å®¹é¡µé¡¶éƒ¨æœç´¢åŒº - é‡æ–°è®¾è®¡ */
        .content-header {
            background: white;
            padding: 25px 20px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
            border-bottom: 1px solid #e9ecef;
        }

        .content-search-box {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 0;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .content-search-input {
            flex: 1;
            padding: 18px 30px;
            border: none;
            font-size: 16px;
            outline: none;
            background: white;
        }

        .content-search-button {
            padding: 18px 50px;
            background: #c8102e;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .content-search-button:hover {
            background: #a00d24;
        }

        .content-search-button.secondary {
            background: #666;
        }

        .content-search-button.secondary:hover {
            background: #555;
        }

        .content-body {
            padding: 40px 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .page-header {
            background: white;
            padding: 30px 40px;
            margin-bottom: 30px;
            border-left: 5px solid #c8102e;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .page-title {
            font-size: 2em;
            color: #333;
            margin-bottom: 10px;
            letter-spacing: 3px;
        }

        .page-subtitle {
            color: #666;
            font-size: 1em;
            letter-spacing: 1px;
        }

        .back-button {
            display: inline-block;
            padding: 12px 30px;
            background: #666;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 20px;
            transition: all 0.3s;
            letter-spacing: 1px;
        }

        .back-button:hover {
            background: #555;
        }

        /* å®˜å‘˜åˆ—è¡¨ */
        .official-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .official-card {
            background: white;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .official-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            border-bottom-color: #c8102e;
        }

        .official-card-name {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 15px;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .official-card-info {
            color: #666;
            font-size: 0.95em;
            line-height: 1.8;
        }

        .official-card-info span {
            display: block;
            margin: 5px 0;
        }

        /* ä¿¡æ¯å¡ç‰‡ */
        .info-card {
            background: white;
            padding: 35px;
            margin-bottom: 30px;
            border-left: 5px solid #c8102e;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .info-card h2 {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 25px;
            letter-spacing: 3px;
            font-weight: 500;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .info-item {
            padding: 20px;
            background: #fafafa;
            border-left: 3px solid #c8102e;
            transition: all 0.3s;
        }

        .info-item:hover {
            background: #f5f5f5;
            transform: translateX(5px);
        }

        .info-label {
            font-size: 0.85em;
            color: #999;
            margin-bottom: 8px;
            letter-spacing: 1px;
        }

        .info-value {
            font-size: 1.1em;
            color: #333;
            font-weight: 500;
        }

        /* æ ‡ç­¾é¡µ */
        .tabs {
            display: flex;
            gap: 0;
            margin-bottom: 30px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .tab {
            flex: 1;
            padding: 18px 30px;
            background: white;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            transition: all 0.3s;
            letter-spacing: 2px;
        }

        .tab.active {
            color: #c8102e;
            border-bottom-color: #c8102e;
            font-weight: bold;
        }

        .tab:hover {
            color: #c8102e;
            background: #fafafa;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .chart-container {
            width: 100%;
            height: 600px;
            min-height: 600px;
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        /* ç½‘ç»œå›¾ä¾‹ */
        .network-legend {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            padding: 20px;
            background: #fafafa;
            border-left: 3px solid #c8102e;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 50%;
        }

        .legend-label {
            font-size: 0.9em;
            color: #666;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 100px 20px;
            color: white;
            font-size: 1.3em;
            letter-spacing: 2px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(200, 16, 46, 0.2);
            border-top-color: #c8102e;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* æç¤ºä¿¡æ¯ */
        .alert {
            padding: 20px 30px;
            margin-bottom: 20px;
            border-left: 5px solid #c8102e;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .alert-success {
            border-left-color: #28a745;
        }

        .alert-warning {
            border-left-color: #ffc107;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5em;
                letter-spacing: 4px;
            }

            .stats-bar {
                flex-direction: column;
                gap: 30px;
            }

            .official-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- é¦–é¡µ -->
    <div id="heroSection" class="hero-section">
        <!-- ç§»è½´èƒŒæ™¯å±‚ -->
        <div class="parallax-bg" id="parallaxBg"></div>
        
        <!-- é®ç½©å±‚ -->
        <div class="hero-overlay"></div>
        
        <!-- Logo - ç‹¬ç«‹äºå†…å®¹å±‚ -->
        <div class="logo">
            <div class="logo-icon">æ¸…</div>
            <div class="logo-text">CGED-Q</div>
        </div>
        
        <!-- å†…å®¹å±‚ -->
        <div class="hero-content">
            <h1 class="hero-title">æ¸…ä»£å®˜å‘˜æ•°æ®åº“</h1>
            <p class="hero-subtitle">ä¸­å›½å†å²å®˜å‘˜é‡åŒ–æ•°æ®åº“å…¬å¼€ç‰ˆ</p>

            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="è¯·è¾“å…¥å®˜å‘˜å§“åã€å®˜èŒæˆ–ç±è´¯...">
                <button onclick="searchOfficial()" class="search-button">æœç´¢</button>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡ä¿¡æ¯ - ç‹¬ç«‹äºå†…å®¹å±‚ -->
        <div class="stats-bar" id="statsBar">
            <div class="stat-item">
                <div class="stat-number" id="statRecords">-</div>
                <div class="stat-label">å®˜å‘˜è®°å½•</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="statOfficials">-</div>
                <div class="stat-label">ä¸åŒå®˜å‘˜</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">1760-1798</div>
                <div class="stat-label">å¹´ä»½èŒƒå›´</div>
            </div>
        </div>
    </div>

    <!-- å®˜å‘˜åˆ—è¡¨é¡µ -->
    <div id="officialListPage" class="content-wrapper" style="display: none;">
        <div class="content-header">
            <div class="content-search-box">
                <input type="text" id="searchInput2" class="content-search-input" placeholder="è¯·è¾“å…¥å®˜å‘˜å§“åã€å®˜èŒæˆ–ç±è´¯...">
                <button onclick="searchOfficialFromContent()" class="content-search-button">æœç´¢</button>
                <button onclick="backToHome()" class="content-search-button secondary">è¿”å›é¦–é¡µ</button>
            </div>
        </div>
        <div class="content-body">
            <div class="container">
                <div class="page-header">
                    <h1 class="page-title">å®˜å‘˜åˆ—è¡¨</h1>
                    <p class="page-subtitle" id="listSubtitle">å…±æ‰¾åˆ° 0 ä½å®˜å‘˜</p>
                </div>

                <div id="officialGrid" class="official-grid"></div>
            </div>
        </div>
    </div>

    <!-- å®˜å‘˜è¯¦æƒ…é¡µ -->
    <div id="officialDetailPage" class="content-wrapper" style="display: none;">
        <div class="content-header">
            <div class="content-search-box">
                <input type="text" id="searchInput3" class="content-search-input" placeholder="è¯·è¾“å…¥å®˜å‘˜å§“åã€å®˜èŒæˆ–ç±è´¯...">
                <button onclick="searchOfficialFromContent()" class="content-search-button">æœç´¢</button>
                <button onclick="goBack()" class="content-search-button secondary">è¿”å›</button>
            </div>
        </div>
        <div class="content-body">
            <div class="container">
                <!-- åŸºæœ¬ä¿¡æ¯ -->
            <div class="info-card">
                <h2>åŸºæœ¬ä¿¡æ¯</h2>
                <div class="info-grid" id="basicInfo"></div>
            </div>

            <!-- å¯è§†åŒ–åˆ†æ -->
            <div class="info-card">
                <h2>å¯è§†åŒ–åˆ†æ</h2>
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('timeline')">ä»•é€”æ—¶é—´çº¿</button>
                    <button class="tab" onclick="switchTab('map')">åœ°ç†è½¨è¿¹</button>
                    <button class="tab" onclick="switchTab('rank')">å“çº§å˜åŒ–</button>
                    <button class="tab" onclick="switchTab('network')">ç¤¾äº¤ç½‘ç»œ</button>
                </div>

                <div id="timeline" class="tab-content active">
                    <div class="chart-container" id="timelineChart"></div>
                </div>

                <div id="map" class="tab-content">
                    <div class="chart-container" id="mapChart"></div>
                </div>

                <div id="rank" class="tab-content">
                    <div class="chart-container" id="rankChart"></div>
                </div>

                <div id="network" class="tab-content">
                    <div class="network-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #5470c6;"></div>
                            <span class="legend-label">åŒæœºæ„å…³ç³»</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #91cc75;"></div>
                            <span class="legend-label">åŒä¹¡å…³ç³»</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #fac858;"></div>
                            <span class="legend-label">åŒæœŸå…³ç³»</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ee6666;"></div>
                            <span class="legend-label">å¸ˆç”Ÿå…³ç³»</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #73c0de;"></div>
                            <span class="legend-label">å®¶æ—å…³ç³»</span>
                        </div>
                    </div>
                    <div class="chart-container" id="networkChart"></div>
                </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½æç¤º -->
    <div id="loadingMsg" class="loading">
        <div class="loading-spinner"></div>
        æ­£åœ¨åŠ è½½æ•°æ®ï¼Œè¯·ç¨å€™...
    </div>

    <script>
        let allData = [];
        let officialHistory = [];
        let currentOfficial = null;
        let currentPage = 'hero'; // hero, list, detail

        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                console.log('å¼€å§‹åŠ è½½æ•°æ®...');
                
                const response = await fetch('data/CGED-Q Public Release 1760-1798  1 Jul 2024.tab');
                
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯! çŠ¶æ€: ${response.status}`);
                }
                
                const arrayBuffer = await response.arrayBuffer();
                let text;
                let usedEncoding = 'UTF-8';
                
                try {
                    const encodings = ['utf-8', 'gbk', 'gb2312', 'gb18030'];
                    
                    for (const encoding of encodings) {
                        try {
                            const decoder = new TextDecoder(encoding);
                            const testText = decoder.decode(arrayBuffer);
                            const sample = testText.substring(0, 1000);
                            
                            if (!sample.includes('ï¿½') && /[\u4e00-\u9fa5]/.test(sample)) {
                                text = testText;
                                usedEncoding = encoding.toUpperCase();
                                console.log(`æˆåŠŸä½¿ç”¨ ${usedEncoding} ç¼–ç è§£æ`);
                                break;
                            }
                        } catch (e) {
                            continue;
                        }
                    }
                    
                    if (!text) {
                        const decoder = new TextDecoder('utf-8');
                        text = decoder.decode(arrayBuffer);
                        usedEncoding = 'UTF-8 (fallback)';
                    }
                    
                } catch (e) {
                    console.error('ç¼–ç è½¬æ¢é”™è¯¯:', e);
                    const decoder = new TextDecoder('utf-8');
                    text = decoder.decode(arrayBuffer);
                }
                
                Papa.parse(text, {
                    header: true,
                    delimiter: '\t',
                    skipEmptyLines: true,
                    complete: function(results) {
                        allData = results.data;
                        document.getElementById('loadingMsg').style.display = 'none';
                        
                        // æ›´æ–°ç»Ÿè®¡æ•°æ®
                        updateStats();
                        
                        console.log('æ•°æ®åŠ è½½æˆåŠŸï¼Œå…±', allData.length, 'æ¡è®°å½•');
                    },
                    error: function(error) {
                        throw new Error('æ•°æ®è§£æå¤±è´¥: ' + error.message);
                    }
                });
                
            } catch (error) {
                console.error('æ•°æ®åŠ è½½å¤±è´¥:', error);
                document.getElementById('loadingMsg').innerHTML = `
                    <div style="color: #c8102e; max-width: 600px; margin: 0 auto;">
                        <h3 style="margin-bottom: 20px;">æ•°æ®åŠ è½½å¤±è´¥</h3>
                        <p>${error.message}</p>
                        <button onclick="loadData()" style="margin-top: 30px; padding: 15px 40px; background: #c8102e; color: white; border: none; cursor: pointer; font-size: 16px;">é‡æ–°åŠ è½½</button>
                    </div>
                `;
            }
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            document.getElementById('statRecords').textContent = allData.length.toLocaleString();
            
            const uniqueOfficials = {};
            allData.forEach(item => {
                const name = (item['å§“'] || '') + (item['å'] || '');
                if (name && name.trim() !== '') {
                    uniqueOfficials[name] = true;
                }
            });
            
            document.getElementById('statOfficials').textContent = Object.keys(uniqueOfficials).length.toLocaleString();
        }

        // æœç´¢å®˜å‘˜ï¼ˆä¸»æœç´¢æ¡†ï¼‰
        function searchOfficial() {
            performSearch('searchInput');
        }

        // ä»å†…å®¹é¡µæœç´¢
        function searchOfficialFromContent() {
            const inputId = currentPage === 'list' ? 'searchInput2' : 'searchInput3';
            performSearch(inputId);
        }

        // æ‰§è¡Œæœç´¢
        function performSearch(inputId) {
            const searchTerm = document.getElementById(inputId).value.trim();
            if (!searchTerm) {
                alert('è¯·è¾“å…¥æœç´¢å†…å®¹');
                return;
            }

            if (allData.length === 0) {
                alert('æ•°æ®å°šæœªåŠ è½½ï¼Œè¯·ç¨å€™...');
                return;
            }

            const results = allData.filter(item => {
                const fullName = (item['å§“'] || '') + (item['å'] || '');
                const position = item['å®˜èŒä¸€'] || '';
                const region = (item['ç±è´¯çœ'] || '') + (item['ç±è´¯å¿'] || '');
                const organization = item['æœºæ„ä¸€'] || '';
                
                return fullName.includes(searchTerm) ||
                       position.includes(searchTerm) ||
                       region.includes(searchTerm) ||
                       organization.includes(searchTerm);
            });

            if (results.length === 0) {
                alert(`æœªæ‰¾åˆ°åŒ…å«"${searchTerm}"çš„ç›¸å…³å®˜å‘˜`);
                return;
            }

            if (results.length === 1) {
                showOfficialDetails(results[0]);
            } else {
                showOfficialList(results);
            }
        }

        // æ˜¾ç¤ºå®˜å‘˜åˆ—è¡¨
        function showOfficialList(officials) {
            currentPage = 'list';
            document.getElementById('heroSection').style.display = 'none';
            document.getElementById('officialListPage').style.display = 'block';
            document.getElementById('officialDetailPage').style.display = 'none';

            // å»é‡
            const uniqueOfficials = {};
            officials.forEach(item => {
                const name = (item['å§“'] || '') + (item['å'] || '');
                if (name && !uniqueOfficials[name]) {
                    uniqueOfficials[name] = item;
                }
            });

            const officialsList = Object.values(uniqueOfficials);
            document.getElementById('listSubtitle').textContent = `å…±æ‰¾åˆ° ${officialsList.length} ä½å®˜å‘˜`;

            const grid = document.getElementById('officialGrid');
            grid.innerHTML = officialsList.map((official, index) => {
                const officialIndex = allData.indexOf(official);
                return `
                    <div class="official-card" onclick="showOfficialDetails(allData[${officialIndex}])">
                        <div class="official-card-name">${official['å§“'] || ''}${official['å'] || ''}</div>
                        <div class="official-card-info">
                            <span>ğŸ“ ${official['ç±è´¯çœ'] || ''}${official['ç±è´¯å¿'] || ''}</span>
                            <span>ğŸ›ï¸ ${official['å®˜èŒä¸€'] || 'èŒä½ä¸è¯¦'}</span>
                            <span>ğŸ“… ${official['é˜³å†å¹´ä»½'] || 'æœªçŸ¥'}å¹´</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // è¿”å›é¦–é¡µ
        function backToHome() {
            currentPage = 'hero';
            document.getElementById('heroSection').style.display = 'flex';
            document.getElementById('officialListPage').style.display = 'none';
            document.getElementById('officialDetailPage').style.display = 'none';
            document.getElementById('searchInput').value = '';
        }

        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            if (officialHistory.length > 0) {
                const previousOfficial = officialHistory.pop();
                showOfficialDetails(previousOfficial, true);
            } else if (currentPage === 'detail') {
                backToHome();
            }
        }

        // æ˜¾ç¤ºå®˜å‘˜è¯¦æƒ…
        function showOfficialDetails(official, fromHistory = false) {
            if (!fromHistory && currentOfficial) {
                officialHistory.push(currentOfficial);
            }
            
            currentOfficial = official;
            currentPage = 'detail';
            
            document.getElementById('heroSection').style.display = 'none';
            document.getElementById('officialListPage').style.display = 'none';
            document.getElementById('officialDetailPage').style.display = 'block';

            showBasicInfo(official);

            const officialName = (official['å§“'] || '') + (official['å'] || '');
            const allRecords = allData.filter(item =>
                (item['å§“'] || '') + (item['å'] || '') === officialName
            );

            setTimeout(() => {
                drawTimeline(allRecords);
                drawMap(allRecords);
                drawRankChart(allRecords);
                drawNetworkChart(official, allData);
            }, 100);
        }

        // æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
        function showBasicInfo(official) {
            const basicInfo = document.getElementById('basicInfo');
            const fields = [
                { label: 'å§“å', value: (official['å§“'] || '') + (official['å'] || '') },
                { label: 'å­—å·', value: official['å­—å·'] || 'æ— ' },
                { label: 'ç±è´¯', value: (official['ç±è´¯çœ'] || '') + (official['ç±è´¯å¿'] || '') },
                { label: 'å‡ºèº«', value: official['å‡ºèº«ä¸€'] || 'æ— ' },
                { label: 'ç§‘å¹´', value: official['ç§‘å¹´ä¸€'] || 'æ— ' },
                { label: 'å®˜èŒ', value: official['å®˜èŒä¸€'] || 'æ— ' },
                { label: 'æœºæ„', value: official['æœºæ„ä¸€'] || 'æ— ' },
                { label: 'åœ°åŒº', value: official['åœ°åŒº'] || 'æ— ' },
                { label: 'æ——åˆ†', value: official['æ——åˆ†'] || 'æ— ' },
                { label: 'èº«ä»½', value: (official['èº«ä»½ä¸€'] || '') + (official['èº«ä»½äºŒ'] || '') },
                { label: 'çˆµä½', value: official['çˆµä½'] || 'æ— ' },
                { label: 'å¹´ä»£', value: (official['é˜³å†å¹´ä»½'] || 'æœªçŸ¥') + 'å¹´' }
            ];

            basicInfo.innerHTML = fields.map(field => `
                <div class="info-item">
                    <div class="info-label">${field.label}</div>
                    <div class="info-value">${field.value}</div>
                </div>
            `).join('');
        }

        // ç»˜åˆ¶ä»•é€”æ—¶é—´çº¿
        function drawTimeline(records) {
            const chartDom = document.getElementById('timelineChart');
            const oldChart = echarts.getInstanceByDom(chartDom);
            if (oldChart) {
                oldChart.dispose();
            }
            const chart = echarts.init(chartDom);
            
            const sortedRecords = records.sort((a, b) => a['é˜³å†å¹´ä»½'] - b['é˜³å†å¹´ä»½']);
            
            const timelineData = sortedRecords.map(record => ({
                name: (record['é˜³å†å¹´ä»½'] || 'æœªçŸ¥') + 'å¹´',
                value: [
                    record['é˜³å†å¹´ä»½'],
                    record['å®˜èŒä¸€'] || 'æœªçŸ¥èŒä½',
                    record['åœ°åŒº'] || 'æœªçŸ¥åœ°åŒº',
                    record['æœºæ„ä¸€'] || 'æœªçŸ¥æœºæ„'
                ]
            }));

            const option = {
                title: {
                    text: 'ä»•é€”æ—¶é—´çº¿',
                    left: 'center',
                    textStyle: {
                        fontSize: 20,
                        fontWeight: 'normal'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        const data = params[0].data.value;
                        return `<strong>${params[0].name}</strong><br/>
                                èŒä½: ${data[1]}<br/>
                                åœ°åŒº: ${data[2]}<br/>
                                æœºæ„: ${data[3]}`;
                    }
                },
                grid: {
                    left: '5%',
                    right: '5%',
                    bottom: '15%',
                    top: '15%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: timelineData.map(d => d.name),
                    axisLabel: {
                        rotate: 45,
                        fontSize: 11
                    }
                },
                yAxis: {
                    type: 'value',
                    show: false
                },
                series: [{
                    type: 'line',
                    data: timelineData.map((d, i) => ({
                        value: [i, i, d.value[2], d.value[3]],
                        name: d.name
                    })),
                    smooth: true,
                    lineStyle: {
                        width: 3,
                        color: '#c8102e'
                    },
                    itemStyle: {
                        color: '#c8102e',
                        borderWidth: 2,
                        borderColor: '#fff'
                    },
                    symbolSize: 10,
                    label: {
                        show: true,
                        position: 'top',
                        formatter: function(params) {
                            return timelineData[params.dataIndex].value[1];
                        },
                        fontSize: 10
                    }
                }]
            };

            chart.setOption(option);
        }

        // æ¸…ä»£ä¸»è¦åœ°ååæ ‡æ˜ å°„
        const qingLocationMap = {
            'åŒ—äº¬': [116.4074, 39.9042], 'é¡ºå¤©': [116.4074, 39.9042], 'ç›´éš¶': [116.4074, 39.9042],
            'å¤©æ´¥': [117.2008, 39.0842], 'ä¿å®š': [115.4648, 38.8736],
            'æ²³å—': [113.6254, 34.7466], 'å¼€å°': [114.3477, 34.7972],
            'å±±ä¸œ': [117.0208, 36.6683], 'æµå—': [117.1205, 36.6519],
            'å±±è¥¿': [112.5489, 37.8706], 'å¤ªåŸ': [112.5489, 37.8706],
            'é™•è¥¿': [108.9540, 34.2656], 'è¥¿å®‰': [108.9540, 34.2656],
            'ç”˜è‚ƒ': [103.8236, 36.0581], 'å…°å·': [103.8236, 36.0581],
            'æ±Ÿè‹': [118.7969, 32.0603], 'å—äº¬': [118.7969, 32.0603], 'æ±Ÿå®': [118.7969, 32.0603], 'è‹å·': [120.5954, 31.2989],
            'æµ™æ±Ÿ': [120.1536, 30.2875], 'æ­å·': [120.1536, 30.2875],
            'å®‰å¾½': [117.2272, 31.8206],
            'æ±Ÿè¥¿': [115.8581, 28.6832], 'å—æ˜Œ': [115.8581, 28.6832],
            'æ¹–åŒ—': [114.3055, 30.5931], 'æ­¦æ˜Œ': [114.3055, 30.5931],
            'æ¹–å—': [112.9388, 28.2282], 'é•¿æ²™': [112.9388, 28.2282],
            'å››å·': [104.0665, 30.5723], 'æˆéƒ½': [104.0665, 30.5723],
            'ç¦å»º': [119.2965, 26.1004], 'ç¦å·': [119.2965, 26.1004],
            'å¹¿ä¸œ': [113.2644, 23.1291], 'å¹¿å·': [113.2644, 23.1291],
            'å¹¿è¥¿': [108.3661, 22.8172], 'æ¡‚æ—': [110.2865, 25.2742],
            'äº‘å—': [102.7103, 25.0406], 'æ˜†æ˜': [102.7103, 25.0406],
            'è´µå·': [106.7073, 26.5982], 'è´µé˜³': [106.7073, 26.5982],
            'å¥‰å¤©': [123.4328, 41.8045], 'ç››äº¬': [123.4328, 41.8045],
            'å‰æ—': [126.5494, 43.8380], 'é»‘é¾™æ±Ÿ': [126.6433, 45.7567],
            'æ–°ç–†': [87.6278, 43.7928], 'è¥¿è—': [91.1174, 29.6470], 'æ‹‰è¨': [91.1174, 29.6470],
            'è’™å¤': [111.6708, 40.8183], 'çƒ­æ²³': [117.9382, 40.9739], 'å¯Ÿå“ˆå°”': [114.8750, 40.8183], 'ç»¥è¿œ': [111.6708, 40.8183]
        };

        // ç»˜åˆ¶åœ°ç†è½¨è¿¹å›¾
        function drawMap(records) {
            const chartDom = document.getElementById('mapChart');
            const oldChart = echarts.getInstanceByDom(chartDom);
            if (oldChart) oldChart.dispose();
            const chart = echarts.init(chartDom);
            
            // æ£€æŸ¥åœ°å›¾æ˜¯å¦åŠ è½½æˆåŠŸ
            if (!chinaMapLoaded) {
                chart.setOption({
                    title: {
                        text: 'åœ°ç†è½¨è¿¹å›¾',
                        subtext: 'åœ°å›¾æ•°æ®åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...',
                        left: 'center',
                        top: 'middle',
                        textStyle: { fontSize: 20, color: '#333' },
                        subtextStyle: { fontSize: 14, color: '#666' }
                    }
                });
                
                // ç­‰å¾…åœ°å›¾åŠ è½½åé‡è¯•
                setTimeout(() => {
                    if (chinaMapLoaded) {
                        drawMap(records);
                    } else {
                        chart.setOption({
                            title: {
                                text: 'åœ°ç†è½¨è¿¹å›¾',
                                subtext: 'åœ°å›¾æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•æˆ–æ£€æŸ¥ç½‘ç»œè¿æ¥',
                                left: 'center',
                                top: 'middle',
                                textStyle: { fontSize: 20, color: '#c8102e' },
                                subtextStyle: { fontSize: 14, color: '#666' }
                            }
                        });
                    }
                }, 3000);
                return;
            }
            
            const sortedRecords = records.sort((a, b) => a['é˜³å†å¹´ä»½'] - b['é˜³å†å¹´ä»½']);
            const yearData = {};
            const allYears = [];
            
            // è™šæ‹Ÿåœ°ç†è½¨è¿¹æ•°æ®ï¼ˆç”¨äºæ¼”ç¤ºï¼‰
            const demoLocations = [
                { name: 'åŒ—äº¬', coords: [116.4074, 39.9042] },
                { name: 'å—äº¬', coords: [118.7969, 32.0603] },
                { name: 'æ­å·', coords: [120.1536, 30.2875] },
                { name: 'å¹¿å·', coords: [113.2644, 23.1291] },
                { name: 'æˆéƒ½', coords: [104.0665, 30.5723] },
                { name: 'è¥¿å®‰', coords: [108.9540, 34.2656] },
                { name: 'æ­¦æ˜Œ', coords: [114.3055, 30.5931] },
                { name: 'ç¦å·', coords: [119.2965, 26.1004] }
            ];
            
            let hasRealData = false;
            
            sortedRecords.forEach(record => {
                const region = record['åœ°åŒº'] || record['ç±è´¯çœ'] || 'æœªçŸ¥';
                const year = record['é˜³å†å¹´ä»½'];
                const position = record['å®˜èŒä¸€'] || 'æœªçŸ¥èŒä½';
                
                let coords = null;
                for (const [place, coord] of Object.entries(qingLocationMap)) {
                    if (region.includes(place) || place.includes(region)) {
                        coords = coord;
                        hasRealData = true;
                        break;
                    }
                }
                
                if (coords && year) {
                    if (!yearData[year]) {
                        yearData[year] = [];
                        allYears.push(year);
                    }
                    yearData[year].push({
                        name: region,
                        value: coords,
                        position: position,
                        year: year
                    });
                }
            });
            
            // å¦‚æœæ²¡æœ‰çœŸå®åœ°ç†æ•°æ®ï¼Œç”Ÿæˆè™šæ‹Ÿæ¼”ç¤ºæ•°æ®
            if (!hasRealData || allYears.length === 0) {
                console.log('æœªæ‰¾åˆ°åœ°ç†ä¿¡æ¯ï¼Œç”Ÿæˆè™šæ‹Ÿæ¼”ç¤ºæ•°æ®');
                sortedRecords.forEach((record, index) => {
                    const year = record['é˜³å†å¹´ä»½'];
                    const position = record['å®˜èŒä¸€'] || 'æœªçŸ¥èŒä½';
                    
                    if (year) {
                        // ä½¿ç”¨è™šæ‹Ÿä½ç½®å¾ªç¯åˆ†é…
                        const demoLocation = demoLocations[index % demoLocations.length];
                        
                        if (!yearData[year]) {
                            yearData[year] = [];
                            allYears.push(year);
                        }
                        
                        yearData[year].push({
                            name: demoLocation.name + 'ï¼ˆæ¼”ç¤ºï¼‰',
                            value: demoLocation.coords,
                            position: position,
                            year: year
                        });
                    }
                });
            }
            
            const sortedYears = allYears.sort((a, b) => a - b);
            
            // ç¡®ä¿è‡³å°‘æœ‰ä¸€äº›æ•°æ®å¯ä»¥æ˜¾ç¤º
            if (sortedYears.length === 0) {
                chart.setOption({
                    title: {
                        text: 'åœ°ç†è½¨è¿¹å›¾',
                        subtext: 'è¯¥å®˜å‘˜æš‚æ— å¯ç”¨çš„åœ°ç†ä¿¡æ¯',
                        left: 'center',
                        top: 'middle',
                        textStyle: { fontSize: 20, color: '#666' },
                        subtextStyle: { fontSize: 14, color: '#999' }
                    }
                });
                return;
            }
            
            if (sortedYears.length > 0) {
                const options = sortedYears.map((year, yearIndex) => {
                    const yearPoints = yearData[year];
                    const lines = [];
                    if (yearIndex > 0) {
                        const prevYear = sortedYears[yearIndex - 1];
                        const prevPoints = yearData[prevYear];
                        if (prevPoints.length > 0 && yearPoints.length > 0) {
                            lines.push({
                                coords: [prevPoints[prevPoints.length - 1].value, yearPoints[0].value]
                            });
                        }
                    }
                    
                    return {
                        title: {
                            text: `åœ°ç†è½¨è¿¹ - ${year}å¹´${!hasRealData ? 'ï¼ˆæ¼”ç¤ºæ•°æ®ï¼‰' : ''}`,
                            left: 'center',
                            top: 10,
                            textStyle: { fontSize: 18, color: '#333' },
                            subtext: !hasRealData ? 'æ³¨ï¼šæ­¤ä¸ºè™šæ‹Ÿæ¼”ç¤ºæ•°æ®' : '',
                            subtextStyle: { fontSize: 12, color: '#999' }
                        },
                        series: [
                            {
                                name: 'ä»»èŒåœ°ç‚¹',
                                type: 'scatter',
                                coordinateSystem: 'geo',
                                data: yearPoints,
                                symbolSize: 25,
                                itemStyle: {
                                    color: '#c8102e',
                                    borderColor: '#fff',
                                    borderWidth: 3,
                                    shadowBlur: 10,
                                    shadowColor: 'rgba(200, 16, 46, 0.5)'
                                },
                                label: {
                                    show: true,
                                    position: 'right',
                                    formatter: '{b}',
                                    fontSize: 13,
                                    color: '#333',
                                    fontWeight: 'bold'
                                }
                            },
                            {
                                name: 'ç§»åŠ¨è½¨è¿¹',
                                type: 'lines',
                                coordinateSystem: 'geo',
                                data: lines,
                                lineStyle: {
                                    color: '#c8102e',
                                    width: 3,
                                    curveness: 0.3,
                                    opacity: 0.6
                                },
                                effect: {
                                    show: true,
                                    period: 4,
                                    trailLength: 0.2,
                                    symbol: 'arrow',
                                    symbolSize: 10,
                                    color: '#a00d24'
                                }
                            }
                        ]
                    };
                });
                
                chart.setOption({
                    baseOption: {
                        timeline: {
                            axisType: 'category',
                            autoPlay: true,
                            playInterval: 3000,
                            data: sortedYears.map(y => y + 'å¹´'),
                            bottom: 30,
                            height: 50,
                            label: { fontSize: 13, color: '#333' },
                            checkpointStyle: { color: '#c8102e', borderColor: '#c8102e' },
                            controlStyle: {
                                showPlayBtn: true,
                                showPrevBtn: true,
                                showNextBtn: true,
                                itemSize: 20,
                                itemGap: 12,
                                normal: { color: '#c8102e' },
                                emphasis: { color: '#a00d24' }
                            },
                            lineStyle: { color: '#c8102e' },
                            itemStyle: { color: '#c8102e' }
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: function(params) {
                                if (params.componentSubType === 'scatter' && params.data) {
                                    return `<div style="padding: 8px;">
                                            <strong style="font-size: 14px;">${params.data.name}</strong><br/>
                                            <span style="color: #666;">å¹´ä»½ï¼š${params.data.year}å¹´</span><br/>
                                            <span style="color: #666;">èŒä½ï¼š${params.data.position}</span>
                                            </div>`;
                                }
                                return params.name;
                            }
                        },
                        geo: {
                            map: 'china',
                            roam: true,
                            zoom: 1.2,
                            center: [105, 36],
                            itemStyle: {
                                areaColor: '#f3f3f3',
                                borderColor: '#999',
                                borderWidth: 1
                            },
                            emphasis: {
                                itemStyle: { areaColor: '#e0e0e0' }
                            },
                            label: { show: false }
                        }
                    },
                    options: options
                });
            }
        }

        // å“çº§æ˜ å°„è¡¨
        const rankMap = {
            'å¤ªå¸ˆ': 1, 'å¤ªå‚…': 1, 'å¤ªä¿': 1, 'å¤§å­¦å£«': 1,
            'å°‘å¸ˆ': 2, 'å°‘å‚…': 2, 'å°‘ä¿': 2, 'å„éƒ¨é™¢å°šä¹¦': 2,
            'å¤ªå­å°‘å¸ˆ': 3, 'å„éƒ¨é™¢å·¦å³ä¾éƒ': 3, 'å†…é˜å­¦å£«': 3,
            'ç¿°æ—é™¢ä¾è¯»å­¦å£«': 4, 'å„çœå·¡æŠš': 4,
            'éƒ½å¯Ÿé™¢å·¦å³å‰¯éƒ½å¾¡å²': 5, 'å¤§ç†å¯ºå¿': 5, 'å„çœæŒ‰å¯Ÿä½¿': 5,
            'å…‰ç¦„å¯ºå¿': 6, 'å¤ªä»†å¯ºå¿': 6,
            'é€šæ”¿ä½¿å¸å‰¯ä½¿': 7, 'é¸¿èƒªå¯ºå¿': 7, 'å„çœé“å‘˜': 7,
            'ç¿°æ—é™¢ä¾è¯»': 8, 'ç¿°æ—é™¢ä¾è®²': 8,
            'å…­ç§‘ç»™äº‹ä¸­': 9, 'å„éƒ¨éƒä¸­': 9, 'å„çœçŸ¥åºœ': 9,
            'ç¿°æ—é™¢ç¼–ä¿®': 10, 'å„éƒ¨å‘˜å¤–éƒ': 10, 'å„çœçŸ¥å·': 10,
            'å›½å­ç›‘å¸ä¸š': 11, 'ä¸»äº‹': 11, 'å„çœé€šåˆ¤': 11,
            'ç¿°æ—é™¢æ£€è®¨': 12, 'å„çœçŸ¥å¿': 12,
            'çŸ¥å¿': 13,
            'ä¸­ä¹¦': 14,
            'å¿ä¸': 15,
            'ä¸»ç°¿': 16,
            'æœªå…¥æµ': 18
        };

        function getRankText(rank) {
            const rankTexts = {
                1: 'æ­£ä¸€å“', 2: 'ä»ä¸€å“', 3: 'æ­£äºŒå“', 4: 'ä»äºŒå“',
                5: 'æ­£ä¸‰å“', 6: 'ä»ä¸‰å“', 7: 'æ­£å››å“', 8: 'ä»å››å“',
                9: 'æ­£äº”å“', 10: 'ä»äº”å“', 11: 'æ­£å…­å“', 12: 'ä»å…­å“',
                13: 'æ­£ä¸ƒå“', 14: 'ä»ä¸ƒå“', 15: 'æ­£å…«å“', 16: 'ä»å…«å“',
                17: 'æ­£ä¹å“', 18: 'ä»ä¹å“'
            };
            return rankTexts[Math.round(rank)] || 'æœªçŸ¥';
        }

        // ç»˜åˆ¶å“çº§å˜åŒ–å›¾
        function drawRankChart(records) {
            const chartDom = document.getElementById('rankChart');
            const oldChart = echarts.getInstanceByDom(chartDom);
            if (oldChart) oldChart.dispose();
            const chart = echarts.init(chartDom);
            
            const sortedRecords = records.sort((a, b) => a['é˜³å†å¹´ä»½'] - b['é˜³å†å¹´ä»½']);
            const chartData = sortedRecords.map(record => {
                const position = record['å®˜èŒä¸€'] || 'æœªçŸ¥';
                const year = (record['é˜³å†å¹´ä»½'] || 'æœªçŸ¥') + 'å¹´';
                let rank = 18;
                for (const [key, value] of Object.entries(rankMap)) {
                    if (position.includes(key)) {
                        rank = value;
                        break;
                    }
                }
                return { year, position, rank, rankText: getRankText(rank) };
            });

            chart.setOption({
                title: { text: 'å®˜èŒå˜åŒ–è¶‹åŠ¿', left: 'center', textStyle: { fontSize: 20, fontWeight: 'normal' } },
                tooltip: {
                    trigger: 'axis',
                    formatter: function(params) {
                        const data = chartData[params[0].dataIndex];
                        return `<strong>${data.year}</strong><br/>å®˜èŒ: ${data.position}<br/>å“çº§: ${data.rankText}`;
                    }
                },
                grid: { left: '10%', right: '10%', bottom: '15%', top: '15%' },
                xAxis: {
                    type: 'category',
                    data: chartData.map(d => d.year),
                    axisLabel: { rotate: 45, interval: 0, fontSize: 10 }
                },
                yAxis: {
                    type: 'value',
                    inverse: true,
                    min: 0,
                    max: 19,
                    interval: 2,
                    axisLabel: { formatter: value => getRankText(value) },
                    name: 'å“çº§'
                },
                series: [{
                    type: 'line',
                    data: chartData.map(d => d.rank),
                    smooth: true,
                    lineStyle: { width: 3, color: '#c8102e' },
                    itemStyle: { color: '#c8102e', borderWidth: 2, borderColor: '#fff' },
                    symbolSize: 10,
                    areaStyle: {
                        color: {
                            type: 'linear',
                            x: 0, y: 0, x2: 0, y2: 1,
                            colorStops: [
                                { offset: 0, color: 'rgba(200, 16, 46, 0.3)' },
                                { offset: 1, color: 'rgba(200, 16, 46, 0.05)' }
                            ]
                        }
                    }
                }]
            });
        }

        // ç»˜åˆ¶ç¤¾äº¤ç½‘ç»œå›¾
        function drawNetworkChart(official, allData) {
            const chartDom = document.getElementById('networkChart');
            const oldChart = echarts.getInstanceByDom(chartDom);
            if (oldChart) oldChart.dispose();
            const chart = echarts.init(chartDom);
            
            const officialName = (official['å§“'] || '') + (official['å'] || '');
            const nodes = [{ name: officialName, symbolSize: 60, category: 0, itemStyle: { color: '#c8102e' } }];
            const links = [];
            const categories = [
                { name: 'æœ¬äºº' }, { name: 'åŒæœºæ„å…³ç³»' }, { name: 'åŒä¹¡å…³ç³»' },
                { name: 'åŒæœŸå…³ç³»' }, { name: 'å¸ˆç”Ÿå…³ç³»' }, { name: 'å®¶æ—å…³ç³»' }
            ];

            const relatedOfficials = new Map();
            
            // åŒæœºæ„
            allData.filter(item =>
                item['æœºæ„ä¸€'] && item['æœºæ„ä¸€'] === official['æœºæ„ä¸€'] &&
                (item['å§“'] || '') + (item['å'] || '') !== officialName
            ).slice(0, 10).forEach(item => {
                const name = (item['å§“'] || '') + (item['å'] || '');
                if (name && !relatedOfficials.has(name)) {
                    relatedOfficials.set(name, { category: 1, relation: 'åŒæœºæ„' });
                    nodes.push({ name, symbolSize: 35, category: 1, itemStyle: { color: '#5470c6' } });
                    links.push({ source: officialName, target: name, value: 'åŒæœºæ„', lineStyle: { color: '#5470c6' } });
                }
            });

            // åŒä¹¡
            allData.filter(item =>
                item['ç±è´¯çœ'] && item['ç±è´¯å¿'] &&
                item['ç±è´¯çœ'] === official['ç±è´¯çœ'] && item['ç±è´¯å¿'] === official['ç±è´¯å¿'] &&
                (item['å§“'] || '') + (item['å'] || '') !== officialName
            ).slice(0, 10).forEach(item => {
                const name = (item['å§“'] || '') + (item['å'] || '');
                if (name && !relatedOfficials.has(name)) {
                    relatedOfficials.set(name, { category: 2, relation: 'åŒä¹¡' });
                    nodes.push({ name, symbolSize: 35, category: 2, itemStyle: { color: '#91cc75' } });
                    links.push({ source: officialName, target: name, value: 'åŒä¹¡', lineStyle: { color: '#91cc75' } });
                }
            });

            // åŒæœŸ
            allData.filter(item =>
                item['é˜³å†å¹´ä»½'] && item['é˜³å†å¹´ä»½'] === official['é˜³å†å¹´ä»½'] &&
                (item['å§“'] || '') + (item['å'] || '') !== officialName
            ).slice(0, 10).forEach(item => {
                const name = (item['å§“'] || '') + (item['å'] || '');
                if (name && !relatedOfficials.has(name)) {
                    relatedOfficials.set(name, { category: 3, relation: 'åŒæœŸ' });
                    nodes.push({ name, symbolSize: 35, category: 3, itemStyle: { color: '#fac858' } });
                    links.push({ source: officialName, target: name, value: 'åŒæœŸ', lineStyle: { color: '#fac858' } });
                }
            });

            if (nodes.length === 1) {
                chart.setOption({
                    title: { text: 'ç¤¾äº¤ç½‘ç»œå…³ç³»å›¾', subtext: 'æœªæ‰¾åˆ°ç›¸å…³ç¤¾äº¤ç½‘ç»œ', left: 'center', top: 'middle' }
                });
                return;
            }

            chart.setOption({
                title: { text: 'ç¤¾äº¤ç½‘ç»œå…³ç³»å›¾', subtext: `å…±å‘ç° ${nodes.length - 1} ä¸ªå…³è”å®˜å‘˜`, left: 'center' },
                tooltip: {
                    formatter: function(params) {
                        if (params.dataType === 'edge') {
                            return `<strong>${params.data.source}</strong> â†’ <strong>${params.data.target}</strong><br/>å…³ç³»: ${params.data.value}`;
                        }
                        return `<strong>${params.data.name}</strong>`;
                    }
                },
                legend: [{ data: categories.map(c => c.name), orient: 'vertical', left: 'left', top: 'middle' }],
                series: [{
                    type: 'graph',
                    layout: 'force',
                    data: nodes,
                    links: links,
                    categories: categories,
                    roam: true,
                    draggable: true,
                    label: { show: true, position: 'right', fontSize: 11 },
                    force: { repulsion: 200, edgeLength: [100, 200], gravity: 0.1 },
                    emphasis: {
                        focus: 'adjacency',
                        label: { fontSize: 14, fontWeight: 'bold' },
                        lineStyle: { width: 4 }
                    },
                    lineStyle: { width: 2, curveness: 0.3 }
                }]
            });

            chart.on('click', function(params) {
                if (params.dataType === 'node' && params.data.name !== officialName) {
                    const clickedOfficial = allData.find(item => 
                        (item['å§“'] || '') + (item['å'] || '') === params.data.name
                    );
                    if (clickedOfficial) {
                        showOfficialDetails(clickedOfficial);
                    }
                }
            });
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            
            setTimeout(() => {
                const chartMap = {
                    'timeline': 'timelineChart',
                    'map': 'mapChart',
                    'rank': 'rankChart',
                    'network': 'networkChart'
                };
                const chartId = chartMap[tabName];
                if (chartId) {
                    const chartInstance = echarts.getInstanceByDom(document.getElementById(chartId));
                    if (chartInstance) chartInstance.resize();
                }
            }, 100);
        }

        // é¡µé¢åŠ è½½
        window.onload = function() {
            loadData();
        };

        // å“åº”å¼è°ƒæ•´
        window.addEventListener('resize', function() {
            ['timelineChart', 'mapChart', 'rankChart', 'networkChart'].forEach(id => {
                echarts.getInstanceByDom(document.getElementById(id))?.resize();
            });
        });
    </script>
</body>
</html>
